// Generated by github.com/yanakipre/bot/internal/status/generator, DO NOT EDIT.

package {{ .PackageName }}

import (
	"encoding/json"
	"time"

	"github.com/go-faster/jx"

	"{{ .GeneratedPackagePath }}"
	"github.com/yanakipre/bot/internal/status"
)

func convertStatus(in *status.Status) {{ .GeneratedPackageName }}.Status {
	out := {{ .GeneratedPackageName }}.Status{
		Code:    in.Code().String(),
		Message: in.Message(),
	}

	details := in.Details()

	if info := details.ErrorInfo; info != nil {
		ei := {{ .GeneratedPackageName }}.ErrorInfo{
			Reason: string(info.Reason),
		}

		if len(info.Metadata) > 0 {
			mm := make(map[string]jx.Raw, len(info.Metadata))

			for k, v := range info.Metadata {
				// Metadata is optional, so if we fail to marshal some of it, we can probably drop it.
				mm[k], _ = json.Marshal(v)
			}

			ei.Metadata.SetTo(mm)
		}

		out.Details.ErrorInfo.SetTo(ei)
	}

	if retry := details.RetryInfo; retry != nil {
		out.Details.RetryInfo.SetTo({{ .GeneratedPackageName }}.RetryInfo{
			RetryDelayMs: int(retry.RetryDelay / time.Millisecond),
		})
	}

	if ufm := details.UserFacingMessage; ufm != nil {
		out.Details.UserFacingMessage.SetTo({{ .GeneratedPackageName }}.UserFacingMessage{
			Message: ufm.Message,
		})
	}

	return out
}
